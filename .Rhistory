geom_point(position = position_dodge(width = 0.5)) +
labs(x = "Predictors", y = "Estimated coefficients") +
theme_bw()
R2_uncorr <- inspect(fit, 'r2')
R2 <- inspect(fit.corrected, 'r2')
#Change of R2:
R2-R2_uncorr
R2_uncorr <- inspect(fit, 'r2')
R2 <- inspect(fit.corrected, 'r2')
# Change of R2:
R2 - R2_uncorr
coef(fit.corrected) / coef(fit)
coef(fit.corrected) / coef(fit)
R2_uncorr <- inspect(fit, 'r2')
R2 <- inspect(fit.corrected, 'r2')
# Change of R2:
R2 - R2_uncorr
?sqp_cmv
Sys.setenv(SQP_USER = 'cimentadaj'); Sys.setenv(SQP_PW = 'Lolasouno2'); Sys.setenv(your_email = "cimentadaj@gmail.com")
devtools::test()
devtools::document()
Sys.setenv(SQP_USER = 'cimentadaj'); Sys.setenv(SQP_PW = 'Lolasouno2'); Sys.setenv(your_email = "cimentadaj@gmail.com")
devtools::build_vignettes()
Sys.setenv(SQP_USER = 'cimentadaj'); Sys.setenv(SQP_PW = 'Lolasouno2'); Sys.setenv(your_email = "cimentadaj@gmail.com")
devtools::build_vignettes()
Sys.setenv(SQP_USER = 'cimentadaj'); Sys.setenv(SQP_PW = 'Lolasouno2'); Sys.setenv(your_email = "cimentadaj@gmail.com")
devtools::test()
devtools::test()
Sys.setenv(SQP_USER = 'cimentadaj'); Sys.setenv(SQP_PW = 'Lolasouno2'); Sys.setenv(your_email = "cimentadaj@gmail.com")
devtools::test()
Sys.setenv(SQP_USER = 'cimentadaj'); Sys.setenv(SQP_PW = 'Lolasouno2'); Sys.setenv(your_email = "cimentadaj@gmail.com")
Sys.setenv(SQP_USER = 'cimentadaj'); Sys.setenv(SQP_PW = 'Lolasouno2'); Sys.setenv(your_email = "cimentadaj@gmail.com")
devtools::check()
Sys.setenv(SQP_USER = 'cimentadaj'); Sys.setenv(SQP_PW = 'Lolasouno2'); Sys.setenv(your_email = "cimentadaj@gmail.com")
devtools::check()
usethis::use_package("lavaan", "suggests")
usethis::use_package("tidyverse", "suggests")
devtools::check()
usethis::use_package_doc()
devtools::document()
??sqpr
?sqpr
devtools::document()
devtools::document()
?sqpr
devtools::document()
?sqpr
?sqpr
devtools::document()
?sqpr
devtools::document()
Sys.setenv(SQP_USER = 'cimentadaj'); Sys.setenv(SQP_PW = 'Lolasouno2'); Sys.setenv(your_email = "cimentadaj@gmail.com")
devtools::check()
Sys.setenv(SQP_USER = 'cimentadaj'); Sys.setenv(SQP_PW = 'Lolasouno2'); Sys.setenv(your_email = "cimentadaj@gmail.com")
devtools::test()
Sys.setenv(SQP_USER = 'cimentadaj'); Sys.setenv(SQP_PW = 'Lolasouno2'); Sys.setenv(your_email = "cimentadaj@gmail.com")
Sys.setenv(SQP_USER = 'cimentadaj'); Sys.setenv(SQP_PW = 'Lolasouno2'); Sys.setenv(your_email = "cimentadaj@gmail.com")
devtools::test()
Sys.setenv(SQP_USER = 'cimentadaj'); Sys.setenv(SQP_PW = 'Lolasouno2'); Sys.setenv(your_email = "cimentadaj@gmail.com")
devtools::test()
sqp_login("cimentadaj@gmail.com", "Lolasouno2")
id <- 4
stopifnot(is.numeric(id), length(id) >= 1)
collapsed_id <- paste0(id, collapse = ",")
url_id <- paste0(sqp_env$questions, collapsed_id, sqp_env$q_estimates)
all_columns = TRUE
q_name <- get_question_name(id)
raw_data <- object_request(url_id, estimates = TRUE)
raw_data
valid_rows <- !is.na(raw_data$authorized)
q_name
id
if (all(c(1, 1) == dim(raw_data))) {
sqp_data <-
sqp_construct_(var_name,
metrics = list(quality = NA_integer_), # random metric
all_columns)
# only for all columns, bc otherwise
# you the 4 column layout of sqp of
# short columns is lost
if (all_columns) sqp_data$question_id <- id
return(sqp_data)
}
var_name <- q_name
if (all(c(1, 1) == dim(raw_data))) {
sqp_data <-
sqp_construct_(var_name,
metrics = list(quality = NA_integer_), # random metric
all_columns)
# only for all columns, bc otherwise
# you the 4 column layout of sqp of
# short columns is lost
if (all_columns) sqp_data$question_id <- id
return(sqp_data)
}
var_name
id
raw_data
valid_rows <- !is.na(raw_data$authorized)
raw_data$authorized
raw_data
raw_data <- raw_data[[1]]
valid_rows <- !is.na(raw_data$authorized)
if (!any(valid_rows)) stop("No valid predictions for", " `", var_name,"`")
raw_data <- raw_data[valid_rows, ]
raw_data
authorized = TRUE
if (authorized) {
row_to_pick <- ifelse(any(raw_data$authorized),
which(raw_data$authorized), 1)
} else {
row_to_pick <- seq_along(nrow(raw_data))
}
cols_to_pick <- if (all_columns) names(raw_data) else sqp_env$short_estimate_variables
final_df <- raw_data[row_to_pick, cols_to_pick]
final_df <- purrr::set_names(final_df, ~ gsub("prediction.", "", .x))
final_df <- tibble::add_column(final_df, question = var_name, .before = 1)
final_df
authorized = FALSE
if (authorized) {
row_to_pick <- ifelse(any(raw_data$authorized),
which(raw_data$authorized), 1)
} else {
row_to_pick <- seq_along(nrow(raw_data))
}
cols_to_pick <- if (all_columns) names(raw_data) else sqp_env$short_estimate_variables
final_df <- raw_data[row_to_pick, cols_to_pick]
final_df <- purrr::set_names(final_df, ~ gsub("prediction.", "", .x))
final_df <- tibble::add_column(final_df, question = var_name, .before = 1)
final_df
raw_data
if (authorized) {
row_to_pick <- ifelse(any(raw_data$authorized),
which(raw_data$authorized), 1)
} else {
row_to_pick <- seq_len(nrow(raw_data))
}
cols_to_pick <- if (all_columns) names(raw_data) else sqp_env$short_estimate_variables
final_df <- raw_data[row_to_pick, cols_to_pick]
final_df <- purrr::set_names(final_df, ~ gsub("prediction.", "", .x))
final_df <- tibble::add_column(final_df, question = var_name, .before = 1)
final_df
as_tibble(final_df)
devtools::document()
Sys.setenv(SQP_USER = 'cimentadaj'); Sys.setenv(SQP_PW = 'Lolasouno2'); Sys.setenv(your_email = "cimentadaj@gmail.com")
devtools::test()
sqp_login()
set.seed(1231)
sqp_data <- get_estimates(4, all_columns = TRUE, authorized = FALSE)
sqp_data
devtools::load_all(".")
sqp_data <- get_estimates(4, all_columns = TRUE, authorized = FALSE)
sqp_login()
set.seed(1231)
sqp_data <- get_estimates(4, all_columns = TRUE, authorized = FALSE)
sqp_data
#' get_estimates(c(1, 2, 86), all_columns = TRUE)
#'
#' # Explore variable names
#'
#' get_question_name(1)
#'
#' get_question_name(1:10)
#'
#' }
#'
get_estimates <- function(id, all_columns = FALSE, authorized = TRUE) {
stopifnot(is.numeric(id), length(id) >= 1)
collapsed_id <- paste0(id, collapse = ",")
url_id <- paste0(sqp_env$questions, collapsed_id, sqp_env$q_estimates)
q_name <- get_question_name(id)
raw_data <- object_request(url_id, estimates = TRUE)
list_data <- purrr::pmap(list(raw_data, q_name, id),
make_estimate_df,
all_columns = all_columns,
authorized = authorized)
final_df <- tibble::as_tibble(do.call(rbind, list_data))
final_df <- sqp_reconstruct(final_df)
final_df
}
sqp_login()
set.seed(1231)
sqp_data <- get_estimates(4, all_columns = TRUE, authorized = FALSE)
sqp_data
expect_length(sqp_data, length(sqp_env$all_estimate_variables))
expect_is(sqp_data, "sqp")
expect_true(nrow(sqp_data) > 1)
expect_true(all(sqp_env$all_estimate_variables %in% names(sqp_data)))
Sys.setenv(SQP_USER = 'cimentadaj'); Sys.setenv(SQP_PW = 'Lolasouno2'); Sys.setenv(your_email = "cimentadaj@gmail.com")
devtools::test()
Sys.setenv(SQP_USER = 'cimentadaj'); Sys.setenv(SQP_PW = 'Lolasouno2'); Sys.setenv(your_email = "cimentadaj@gmail.com")
devtools::check()
usethis::use_readme_rmd()
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>",
fig.path = "man/figures/README-",
out.width = "100%"
)
sqp_login("cimentadaj@gmail.com", "Lolasouno2")
devtools::load_all(".")
sqp_login("cimentadaj@gmail.com", "Lolasouno2")
sqp_login()
sqp_login()
find_studies("ess")
find_studies("ESS Round 4")
find_studies("ESS Round 4")
ess_four <- find_studies("ESS Round 4")
ess_four
find_questions(ess_four$id, "tv")
q_ess <- find_questions(ess_four$id, "tv")
q_ess
q_ess[q_ess$language_iso == "spa", ]
sp_tv <- q_ess[q_ess$language_iso == "spa", ]
sp_tv
get_estimates(sp_tv$id)
predictions <- get_estimates(sp_tv$id)
predictions
Sys.setenv(SQP_USER = 'cimentadaj'); Sys.setenv(SQP_PW = 'Lolasouno2'); Sys.setenv(your_email = "cimentadaj@gmail.com")
Sys.setenv(SQP_USER = 'cimentadaj'); Sys.setenv(SQP_PW = 'Lolasouno2'); Sys.setenv(your_email = "cimentadaj@gmail.com")
devtools::check()
Sys.setenv(SQP_USER = 'cimentadaj'); Sys.setenv(SQP_PW = 'Lolasouno2'); Sys.setenv(your_email = "cimentadaj@gmail.com")
devtools::document()
Sys.setenv(SQP_USER = 'cimentadaj'); Sys.setenv(SQP_PW = 'Lolasouno2'); Sys.setenv(your_email = "cimentadaj@gmail.com")
library(sqpr)
Sys.setenv(SQP_USER = 'annadci')
#Jorge: I can also log in with my username! :)
# I think you should mention that it is possible with
# the email or with the username
Sys.setenv(SQP_PW = 'adcisqp')
sqp_login()
find_studies("ess")
study_id <- find_studies("ESS Round 4")$id
find_questions(study_id, "tv")
tv_qs <- find_questions(study_id, "^tv")
sp_tv <- tv_qs[tv_qs$language_iso == "spa", ]
sp_tv
get_estimates(sp_tv$id)
find_studies("old")
study_id2 <- find_studies("Old 102")$id
find_questions(study_id2, "102.1.3")
get_estimates(my_q$id)
my_q <- find_questions(study_id2, "102.1.3")
get_estimates(my_q$id)
get_estimates(sp_tv$id, all_columns = TRUE)
get_estimates(sp_tv$id, all_columns = TRUE, FALSE)
get_estimates(sp_tv$id, all_columns = TRUE)
get_estimates(my_q$id, all_columns = T)
View(get_estimates(my_q$id, all_columns = T))
ess7 <- find_studies("ESS Round 7")$id
ess7q <- find_questions(ess7, "cptppol")
ess7qeng <- ess7q[ess7q$language_iso == "eng", ]
ess7qeng
get_estimates(ess7qeng$id)
get_estimates(ess7qeng$id, FALSE)
devtools::load_all(".")
get_estimates(ess7qeng$id, FALSE)
sqp_login("cimentadaj@gmail.com", "Lolasouno2")
get_estimates(ess7qeng$id, FALSE)
get_estimates(ess7qeng$id, TRUE)
get_estimates(ess7qeng$id, authorized = FALSE)
get_estimates(ess7qeng$id, TRUE, authorized = FALSE)
get_estimates(my_q$id, all_columns = T)
devtools::document()
devtools::document()
Sys.setenv(SQP_USER = 'cimentadaj'); Sys.setenv(SQP_PW = 'Lolasouno2'); Sys.setenv(your_email = "cimentadaj@gmail.com")
devtools::check()
set.seed(2131)
library(tibble)
corr_tibble <- sqp_correlate(matrix(rnorm(100, sd = 50), nrow = 20), rnorm(5))
devtools::load_all(".")
corr_tibble <- sqp_correlate(matrix(rnorm(100, sd = 50), nrow = 20), rnorm(5))
sqp_df <-
tibble(question = paste0("V", 1:5),
quality = c(0.2, 0.3, 0.5, 0.6, 0.9),
reliability = c(NA, 0.4, 0.5, 0.5, 0.7),
validity = c(NA, NA, 0.6, 0.7, 0.8))
sqp_df
sqp_df <- structure(sqp_df, class = c(class(sqp_df), "sqp"))
corr_tibble
sqp_cmv(corr_tibble, sqp_df, V4, V5)
library(tibble)
sqp_df <-
tibble(question = paste0("V", 1:5),
quality = c(0.2, 0.3, 0.5, 0.6, 0.9),
reliability = c(NA, 0.4, 0.5, 0.5, 0.7),
validity = c(NA, NA, 0.6, 0.7, 0.8))
sqp_df <- structure(sqp_df, class = c(class(sqp_df), "sqp"))
sqp_bind_metrics(sqp_df, new_question, list(quality = 0.7))
sqp_bind_metrics(sqp_df, new_question, list(quality = 0.7, reliability = 0.2))
library(tibble)
sqp_df <-
tibble(question = paste0("V", 1:5),
quality = c(0.2, 0.3, 0.5, 0.6, 0.9),
reliability = c(0.2, 0.4, 0.5, 0.5, 0.7),
validity = c(0.8, 0.1, 0.6, 0.7, 0.8))
sqp_df <- structure(sqp_df, class = c(class(sqp_df), "sqp"))
sample_data <-
as_tibble(
setNames(
replicate(5, rbinom(1000, 5, 0.6), simplify = FALSE),
paste0("V", 1:5))
)
sqp_sscore(
sqp_data = sqp_df,
df = sample_data,
new_name = new_sumscore,
V3, V4
)
sqp_sscore(
sqp_data = sqp_df,
df = sample_data,
new_name = new_sumscore,
"V1", "V2"
)
Sys.setenv(SQP_USER = 'cimentadaj'); Sys.setenv(SQP_PW = 'Lolasouno2'); Sys.setenv(your_email = "cimentadaj@gmail.com")
devtools::check()
Sys.setenv(SQP_USER = 'cimentadaj'); Sys.setenv(SQP_PW = 'Lolasouno2'); Sys.setenv(ess_email = "cimentadaj@gmail.com")
devtools::test()
Sys.setenv(SQP_USER = 'cimentadaj'); Sys.setenv(SQP_PW = 'Lolasouno2'); Sys.setenv(ess_email = "cimentadaj@gmail.com")
devtools::check()
devtools::check()
devtools::check()
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>",
message = FALSE,
warning = FALSE
)
library("lavaan")
library("tidyverse")
library("essurvey")
library("sqpr")
your_email <- Sys.getenv("your_email")
your_email
your_email <- Sys.getenv("ess_email")
your_email
Sys.setenv(SQP_USER = 'cimentadaj'); Sys.setenv(SQP_PW = 'Lolasouno2'); Sys.setenv(ess_email = "cimentadaj@gmail.com")
your_email <- Sys.getenv("ess_email")
ess7es <-
import_country("Spain", 7, your_email) %>%
recode_missings()
Sys.setenv(SQP_USER = 'cimentadaj'); Sys.setenv(SQP_PW = 'Lolasouno2'); Sys.setenv(ess_email = "cimentadaj@gmail.com")
devtools::check()
devtools::check()
Sys.setenv(SQP_USER = 'cimentadaj'); Sys.setenv(SQP_PW = 'Lolasouno2'); Sys.setenv(ess_email = "cimentadaj@gmail.com")
devtools::check()
devtools::check()
Sys.setenv(SQP_USER = 'cimentadaj'); Sys.setenv(SQP_PW = 'Lolasouno2'); Sys.setenv(ess_email = "cimentadaj@gmail.com")
devtools::check()
Sys.setenv(ess_email = "cimentadaj@gmail.com")
devtools::test()
Sys.setenv(SQP_USER = "cimentadaj")
Sys.setenv(SQP_PW = "Lolasouno2")
devtools::test()
?sqp_login
Sys.setenv(SQP_USER = "cimentadaj")
Sys.setenv(SQP_PW = "Lolasouno2")
sqp_login()
correct_df <- get_questions(12)
row_n <- 10
sqp_login()
set.seed(1231)
sqp_data <- get_estimates(sample(1:1000, row_n))
sqp_data
sqp_login()
set.seed(1231)
sqp_data <- get_estimates(sample(1:1000, row_n), all_columns = TRUE)
sqp_login()
set.seed(1231)
sqp_data <- get_estimates(4, all_columns = TRUE, authorized = FALSE)
sqp_data
sqp_data <- get_estimates(86, all_columns = TRUE)
sqp_data
sqp_login()
correct_df <- get_questions(12)
Sys.setenv(SQP_USER = 'cimentadaj'); Sys.setenv(SQP_PW = 'Lolasouno2'); Sys.setenv(ess_email = "cimentadaj@gmail.com")
devtools::test()
sqp_login()
correct_df <- get_questions(12)
sqp_login()
expect_error(get_questions(numeric()),
sqp_login()
expect_error(get_questions(numeric()),
"length\\(.*\\) != 0 is not TRUE")
get_questions(numeric())
sqp_login()
expect_error(get_questions(numeric()),
"length\\(.*\\) != 0 is not TRUE")
expect_error(get_questions(9^9e00),
"Study [0-9]+ was not found. Check get_studies()")
expect_error(get_questions("ess"),
regexp = ".* is not TRUE")
get_questions("ess")
sqp_login()
regexp <- find_questions(12, "a$")
Sys.setenv(SQP_USER = 'cimentadaj'); Sys.setenv(SQP_PW = 'Lolasouno2'); Sys.setenv(ess_email = "cimentadaj@gmail.com")
devtools::test()
Sys.setenv(SQP_USER = 'cimentadaj'); Sys.setenv(SQP_PW = 'Lolasouno2'); Sys.setenv(ess_email = "cimentadaj@gmail.com")
devtools::test()
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>",
message = FALSE,
warning = FALSE
)
library(lavaan)
library(tidyverse)
library(essurvey)
library(sqpr)
ess7es <-
import_country("Spain", 7, your_email) %>%
recode_missings()
ess_email <- Sys.getenv("ess_email")
ess7es <-
import_country("Spain", 7, ess_email) %>%
recode_missings()
ess7es <-
ess7es %>%
mutate(poltrst = trstprl + trstplt + trstprt,
serv = stfedu + stfhlth,
systmrsp = psppsgv + psppipl + ptcpplt)
selected_vars <- c("trstprl", "trstplt", "trstprt",
"stfedu", "stfhlth", "psppsgv",
"psppipl", "ptcpplt", "ppltrst",
"polintr", "stflife", "stfeco",
"agea","eisced")
composite_scores <- c("poltrst", "serv", "systmrsp")
all_vars <- c(composite_scores, selected_vars) # for using later
ess7es
sqp_login()
study_id <- find_studies("ESS Round 7")$id
questions <-
study_id %>%
find_questions(selected_vars[1:12]) %>%
filter(country_iso == "ES", language_iso == "spa")
all(tolower(questions$short_name) %in% selected_vars[1:12])
sqp_data <-
get_estimates(questions$id) %>%
arrange(question)
sqp_data
sqp_sscore(sqp_data = sqp_data,
df = ess7es,
new_name = poltrst,
trstprl, trstplt, trstprt)
Quality <-
sqp_data %>%
sqp_sscore(df = ess7es, new_name = poltrst, trstprl, trstplt, trstprt) %>%
sqp_sscore(df = ess7es, new_name = serv, stfedu, stfhlth) %>%
sqp_sscore(df = ess7es, new_name = systmrsp, psppsgv, psppipl, ptcpplt)
Quality
Sys.setenv(SQP_USER = 'cimentadaj'); Sys.setenv(SQP_PW = 'Lolasouno2'); Sys.setenv(ess_email = "cimentadaj@gmail.com")
devtools::check()
Sys.setenv(SQP_USER = 'cimentadaj'); Sys.setenv(SQP_PW = 'Lolasouno2'); Sys.setenv(ess_email = "cimentadaj@gmail.com")
devtools::check()
Sys.setenv(SQP_USER = 'cimentadaj'); Sys.setenv(SQP_PW = 'Lolasouno2'); Sys.setenv(ess_email = "cimentadaj@gmail.com")
devtools::test()
devtools::test()
Sys.setenv(SQP_USER = 'cimentadaj'); Sys.setenv(SQP_PW = 'Lolasouno2'); Sys.setenv(ess_email = "cimentadaj@gmail.com")
devtools::test()
devtools::test()
Sys.setenv(SQP_USER = 'cimentadaj'); Sys.setenv(SQP_PW = 'Lolasouno2'); Sys.setenv(ess_email = "cimentadaj@gmail.com")
sqp_login("hey", "ho")
test_that("login fails with random account", {
expect_error(sqp_login("hey", "ho"),
"^Failed to login with that username/password")
})
sqp_env$token <- NULL
sqp_login()
sqp_env$token == ""
test_that("login succeeds with environment variables", {
expect_silent(sqp_login())
expect_false(sqp_env$token == "")
})
sqp_env$token <- NULL
user <- Sys.getenv("SQP_USER")
pw <- Sys.getenv("SQP_PW")
Sys.unsetenv("SQP_USER")
Sys.unsetenv("SQP_PW")
test_that("login succeeds with variables as", {
options(SQP_USER = user, SQP_PW = pw)
expect_silent(sqp_login())
expect_false(sqp_env$token == "")
})
Sys.setenv(SQP_USER = 'cimentadaj'); Sys.setenv(SQP_PW = 'Lolasouno2'); Sys.setenv(ess_email = "cimentadaj@gmail.com")
devtools::test()
Sys.setenv(SQP_USER = 'cimentadaj'); Sys.setenv(SQP_PW = 'Lolasouno2'); Sys.setenv(ess_email = "cimentadaj@gmail.com")
devtools::check()
Sys.setenv(SQP_USER = 'cimentadaj'); Sys.setenv(SQP_PW = 'Lolasouno2'); Sys.setenv(ess_email = "cimentadaj@gmail.com")
devtools::test()
Sys.setenv(SQP_USER = 'cimentadaj'); Sys.setenv(SQP_PW = 'Lolasouno2'); Sys.setenv(ess_email = "cimentadaj@gmail.com")
knitr::opts_chunk$set(
collapse = TRUE,
comment = "#>",
fig.path = "man/figures/README-",
out.width = "100%"
)
library(sqpr)
sqp_login()
ess_four <- find_studies("ESS Round 4")
ess_four
q_ess <- find_questions(ess_four$id, "tv")
sp_tv <- q_ess[q_ess$language_iso == "spa", ]
sp_tv
predictions <- get_estimates(sp_tv$id)
predictions
Sys.setenv(SQP_USER = 'cimentadaj'); Sys.setenv(SQP_PW = 'Lolasouno2'); Sys.setenv(ess_email = "cimentadaj@gmail.com")
system("open .")
rmarkdown::pandoc_version()
Sys.setenv(SQP_USER = 'cimentadaj'); Sys.setenv(SQP_PW = 'Lolasouno2'); Sys.setenv(ess_email = "cimentadaj@gmail.com")
Sys.setenv(SQP_USER = 'cimentadaj'); Sys.setenv(SQP_PW = 'Lolasouno2'); Sys.setenv(ess_email = "cimentadaj@gmail.com")
devtools::check()
