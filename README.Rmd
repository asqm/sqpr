---
output:
  github_document:
    html_preview: true
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "README-",
  out.width = "100%"
)
```
 
## sqpr <img src="man/figures/sqpr_logo.png" align="right" width="200" height="200" />

[![CRAN status](https://www.r-pkg.org/badges/version/sqpr)](https://cran.r-project.org/package=sqpr)
[![Travis build status](https://travis-ci.org/sociometricresearch/sqpr.svg?branch=master)](https://travis-ci.org/sociometricresearch/sqpr)
[![AppVeyor build status](https://ci.appveyor.com/api/projects/status/github/sociometricresearch/sqpr?branch=master&svg=true)](https://ci.appveyor.com/project/cimentadaj/sqpr)
[![Codecov test coverage](https://codecov.io/gh/sociometricresearch/sqpr/branch/master/graph/badge.svg)](https://codecov.io/gh/sociometricresearch/sqpr?branch=master)


The `sqpr` package gives easy access to the API of the Survey Quality Prediction [website](http://sqp.upf.edu/), a data base that contains over 40,000 predictions on the quality of questions.

## Important changes

After the feedback received at the [ESRA 2019 conference](https://www.europeansurveyresearch.org/conferences/overview), the `sqpr` package has been decoupled into two packages. The first will be responsible for only obtaining the data from the SQP API (`sqpr`) and the second will have all the measurement error corrections implemented separately. This way, measurement error corrections can happen independently of the SQP software for anyone who has other survey quality information. This new package is still under construction and will be uploaded as soon as it has working value. 

Currently, the `sqpr` package is not **usable**. This package is being tested on the new SQP 3.0 API and not on the published website of the SQP [here](http://sqp.upf.edu/).

If you have any questions, please contact us at <cimentadaj@gmail.com>.

## Installation

`sqpr` is not currently on CRAN but you can install the developing version of from Github with:

```{r, eval = FALSE}
# install.packages("devtools")
devtools::install_github("sociometricresearch/sqpr")
```

## Example


### Registration and logging in

Register in the [SQP website](http://sqp.upf.edu/accounts/register/) and confirm your registration through your email.

First, load the package in R and provide your registered credentials.

```{r, echo = FALSE}
library(sqpr)
sqp_login()
```

```{r, eval = FALSE}
library(sqpr)
sqp_login('your username', 'your password')
```

For details on the login process see the `Accessing the SQP 3.0 API vignette` from the package.

Once you've ran `sqp_login()`, you're all set to work with the SQP 3.0 3.0 API! No need to run it again unless you close the R session.

## Exploring the SQP 3.0 API

You can query all the questions in a specific study to check whether a specific question has quality predictions. Use `find_studies` to locate the `id` of a certain study

```{r}
ess_four <- find_studies("ESS Round 4")
ess_four
```

Ok, so we have our `study_id`. Which questions are in that study? `find_questions` will do the work for you.

```{r}
q_ess <- find_questions(ess_four$id, "tv")
```

That might take a while because it's downloading all of the data to your computer. Let's query further down to get questions for a specific question.
```{r}
sp_tv <- q_ess[q_ess$language_iso == "spa", ]
sp_tv
```

The hard part is done now. Once we have the `id` of your questions of interest, we supply it to `get_estimates` and it will bring the quality predictions for those questions.

```{r}
predictions <- get_estimates(sp_tv$id)
predictions
```

`get_estimates` will return all question names as lower case for increasing the chances of compatibility with the name in the questionnaire of the study.
